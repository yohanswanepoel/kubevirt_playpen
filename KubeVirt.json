{"version":21,"variables":[],"tiles":{"1":{"title":"KubeVirt - Virtual Machines instances","type":"data","query":"smartscapeNodes \"K8S*\"\n// | filter k8s.namespace.name == \"default\"\n| filter isNotNull(`tags:k8s.labels`[kubevirt.io])\n| filter type == \"K8S_POD\"\n// | filter name == \"virtualmachineinstances.kubevirt.io\"\n| filter `tags:k8s.labels`[kubevirt.io] == \"virt-launcher\"\n| summarize count()","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","prefixIcon":"DesktopIcon","colorThresholdTarget":"background"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"count","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-status-ideal-default, #2f6862)"},"comparator":"≥","label":"","value":1},{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"=","label":"","value":0}]}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"2":{"title":"Virtual Machines","type":"data","query":"smartscapeNodes \"K8S*\"\n// | filter k8s.namespace.name == \"default\"\n| filter isNotNull(`tags:k8s.labels`[kubevirt.io])\n| filter type == \"K8S_POD\"\n// | filter name == \"virtualmachineinstances.kubevirt.io\"\n| filter `tags:k8s.labels`[kubevirt.io] == \"virt-launcher\"\n| fields k8s.node.name, k8s.namespace.name, pod_name = name, vm_name = `tags:k8s.labels`[`vm.kubevirt.io/name`], k8s.object","visualization":"table","visualizationSettings":{"autoSelectVisualization":true,"table":{"hideColumnsForLargeResults":true}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"3":{"title":"Cluster CPU Status","type":"data","query":"timeseries result = sum(dt.kubernetes.container.cpu_usage, default: 0, rollup: sum, rate: 1m), nonempty: true, by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"CPU usage\"\n| append[timeseries result = sum(dt.kubernetes.container.cpu_throttled, default: 0, rollup: sum, rate: 1m), nonempty: true, by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"CPU throttled\"]\n| append[timeseries result = sum(dt.kubernetes.container.requests_cpu, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"CPU requests\"]\n| append[timeseries result = sum(dt.kubernetes.container.limits_cpu, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"CPU limits\"]\n| append[timeseries result = sum(dt.kubernetes.node.cpu_allocatable, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"CPU allocatable\"]","visualization":"lineChart","visualizationSettings":{"chartSettings":{"legend":{"position":"bottom","ratio":17.5},"tooltip":{"variant":"shared"},"seriesOverrides":[{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","CPU usage","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"geometry":"line"}},{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","CPU throttled","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-07-default, #438fb1)"},"geometry":"line"}},{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","CPU requests","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-02-default, #2c2f3f)"},"geometry":"line"}},{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","CPU limits","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-15-default, #9033a3)"},"geometry":"line"}},{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","CPU allocatable","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-05-default, #84859a)"},"geometry":"line"}}]},"dataMapping":{"displayedFields":["metricName"]},"autoSelectVisualization":false,"thresholds":[]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-30m","to":"now()"}}},"4":{"title":"Cluster Memory Status","type":"data","query":"timeseries result = sum(dt.kubernetes.container.memory_working_set, default: 0, rollup: sum, rate: 1m), nonempty: true, by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"Memory usage (working set)\"\n| append[timeseries result = sum(dt.kubernetes.container.requests_memory, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"Memory requests\"]\n| append[timeseries result = sum(dt.kubernetes.container.limits_memory, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"Memory limits\"]\n| append[timeseries result = sum(dt.kubernetes.node.memory_allocatable, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"Memory allocatable\"]","visualization":"lineChart","visualizationSettings":{"chartSettings":{"legend":{"position":"bottom","ratio":17.5},"tooltip":{"variant":"shared"},"seriesOverrides":[{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","Memory usage (working set)","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"geometry":"line"}},{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","Memory requests","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-02-default, #2c2f3f)"},"geometry":"line"}},{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","Memory limits","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-15-default, #9033a3)"},"geometry":"line"}},{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","Memory allocatable","result"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-05-default, #84859a)"},"geometry":"line"}}]},"dataMapping":{"displayedFields":["metricName"]},"autoSelectVisualization":false,"thresholds":[]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-30m","to":"now()"}}},"5":{"title":"Cluster Network","type":"data","query":"timeseries result = sum(dt.kubernetes.pod.network_transmitted_data, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"Transmitted data\"\n| append[timeseries result = sum(dt.kubernetes.pod.network_received_data, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"Received data\"]","visualization":"lineChart","visualizationSettings":{"chartSettings":{"legend":{"position":"bottom","ratio":17.5},"tooltip":{"variant":"shared"},"seriesOverrides":[{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","Transmitted data","result"],"override":{"geometry":"line"}},{"seriesId":["K8S_CLUSTER-ED1F24AE3627A210","Received data","result"],"override":{"geometry":"line"}}]},"dataMapping":{"displayedFields":["metricName"]},"autoSelectVisualization":false,"thresholds":[]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-30m","to":"now()"}}},"6":{"title":"Cluster Errors","type":"data","query":"timeseries result = sum(dt.kubernetes.pod.network_transmitted_errors, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"Transmitted errors\"\n| append[timeseries result = sum(dt.kubernetes.pod.network_received_errors, rollup: sum, rate: 1m), by:{dt.smartscape.k8s_cluster}, filter: dt.smartscape.k8s_cluster == \"K8S_CLUSTER-ED1F24AE3627A210\" | fieldsAdd metricName = \"Received errors\"]","visualization":"lineChart","visualizationSettings":{"chartSettings":{"legend":{"position":"bottom","ratio":17.5},"tooltip":{"variant":"shared"}},"dataMapping":{"displayedFields":["metricName"]},"autoSelectVisualization":false,"thresholds":[]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-30m","to":"now()"}}},"7":{"title":"KubeVirt PVC Claims","type":"data","query":"smartscapeNodes \"K8S*\"\n// | filter type == \"\"\n// | filter name == \"virtualmachineinstances.kubevirt.io\"\n// | summarize count(), by: {type}\n| filter type == \"K8S_PERSISTENTVOLUMECLAIM\"\n| filter isNotNull(`tags:k8s.annotations`[`cdi.kubevirt.io/createdForDataVolume`])\n| fieldsAdd `pvc_type` = `tags:k8s.annotations`[`cdi.kubevirt.io/storage.contentType`]\n| filter pvc_type == \"kubevirt\"\n| summarize count()","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","prefixIcon":"DesktopIcon","colorThresholdTarget":"background"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"count","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-status-ideal-default, #2f6862)"},"comparator":"≥","label":"","value":1},{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"=","label":"","value":0}]}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"8":{"title":"PVC Claims","type":"data","query":"smartscapeNodes \"K8S*\"\n// | filter type == \"\"\n// | filter name == \"virtualmachineinstances.kubevirt.io\"\n// | summarize count(), by: {type}\n| filter type == \"K8S_PERSISTENTVOLUMECLAIM\"\n| filter isNotNull(`tags:k8s.annotations`[`cdi.kubevirt.io/createdForDataVolume`])\n| filter k8s.namespace.name == \"default\"\n| fieldsAdd `pvc_type` = `tags:k8s.annotations`[`cdi.kubevirt.io/storage.contentType`]\n| filter pvc_type == \"kubevirt\"\n| fields name, image_endpoint = `tags:k8s.annotations`[`cdi.kubevirt.io/storage.import.endpoint`], provisioner = `tags:k8s.annotations`[`volume.kubernetes.io/storage-provisioner`], k8s.persistentvolume.name","visualization":"table","visualizationSettings":{"autoSelectVisualization":true,"table":{"hideColumnsForLargeResults":true}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"9":{"title":"Virtual Machines","type":"data","query":"// [pod-explorer]\nsmartscapeNodes { K8S_POD }\n| filter `tags:k8s.labels`[kubevirt.io] == \"virt-launcher\"\n| fieldsAdd cluster.name = k8s.cluster.name, node.name = k8s.node.name, namespace.name = k8s.namespace.name, workload.name = k8s.workload.name, pod.name = name\n// Fields: related cluster\n| fieldsAdd cluster.id = arrayFirst(toArray(references[belongs_to.k8s_cluster])), cluster.cluster_id = k8s.cluster.uid\n| fieldsAdd cluster.entity = record(entityId = cluster.id, displayName = k8s.cluster.name)\n| fieldsAdd cluster.distribution = getNodeField(cluster.id, \"k8s.cluster.distribution\")\n// Filters: [cluster-entity]\n// | filter cluster.entity[displayName] == \"k8s-kubevirt\"\n// Fields: related namespace\n| fieldsAdd namespace.id = arrayFirst(toArray(references[belongs_to.k8s_namespace]))\n| fieldsAdd namespace.entity = record(entityId = namespace.id, displayName = k8s.namespace.name)\n// Filters: [namespace-entity]\n// | filter namespace.entity[displayName] == \"default\"\n| limit 500\n| lookup [\n  // [container_restarts-aggregated]\ntimeseries values = sum(dt.kubernetes.container.restarts, rollup:sum),\n  by:{dt.smartscape.k8s_pod},\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd container_restarts = arraySum(values), id = dt.smartscape.k8s_pod\n], sourceField:id, lookupField:id, fields:{container_restarts}, executionOrder:leftFirst\n| lookup [\n  // [container_oom_kills-aggregated]\ntimeseries values = sum(dt.kubernetes.container.oom_kills, rollup:sum),\n  by:{dt.smartscape.k8s_pod},\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd container_oom_kills = arraySum(values), id = dt.smartscape.k8s_pod\n], sourceField:id, lookupField:id, fields:{container_oom_kills}, executionOrder:leftFirst\n| lookup [\n  // [pod_warning_events_now]\n  timeseries warning_event_count = sum(dt.kubernetes.events), timeframe: timeframe(from: -10m, to: -2m),\n  by:{reason = k8s.event.reason, dt.smartscape.k8s_pod},\n  filter: k8s.event.type == \"Warning\" and k8s.event.involved_object.kind == \"Pod\" and isNotNull(dt.smartscape.k8s_pod)\n| fields warningEvent = record(warning_event_count = arraySum(warning_event_count), reason), relatedEntity = dt.smartscape.k8s_pod\n| sort warningEvent[warning_event_count] desc\n| summarize pod_warning_events = collectArray(warningEvent), by:{relatedEntity}\n  | fieldsAdd pod_warning_events_now = pod_warning_events\n], sourceField:id, lookupField:relatedEntity, fields:{pod_warning_events,pod_warning_events_now}, executionOrder:leftFirst\n// [pod.signals_now]\n| fieldsAdd pod.signals_now = record(events = pod_warning_events_now)\n| lookup [\n  // [containers.running_now]\n  timeseries values = sum(dt.kubernetes.containers, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod) AND container_state == \"running\"\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd containers.running_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{containers.running_now}, executionOrder:leftFirst\n| lookup [\n  // [containers.desired_now]\n  timeseries values = sum(dt.kubernetes.pod.containers_desired, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd containers.desired_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{containers.desired_now}, executionOrder:leftFirst\n// [containers_now]\n| fieldsAdd containers_now = record(running = containers.running_now, desired = containers.desired_now)\n| fieldsAdd k8s.object = if(isNotNull(k8s.object), k8s.object, else: getNodeField(id, \"k8s.object\"))\n| parse k8s.object, \"JSON:k8s.object\"\n| fieldsAdd pod.conditions = k8s.object[status][conditions]\n   // Collect all fulfilled conditions, significance is given by array index\n   | fieldsAdd pod.temp_all_conditions = array(\n     iCollectArray(if(pod.conditions[][status] == \"True\" and pod.conditions[][type] == \"Ready\", pod.conditions[], else:null)),\n     iCollectArray(if(pod.conditions[][status] == \"True\" and pod.conditions[][type] == \"ContainersReady\", pod.conditions[], else:null)),\n     iCollectArray(if(pod.conditions[][status] == \"True\" and pod.conditions[][type] == \"Initialized\", pod.conditions[], else:null)),\n     iCollectArray(if(pod.conditions[][status] == \"True\" and pod.conditions[][type] == \"PodReadyToStartContainers\", pod.conditions[], else:null)),\n     iCollectArray(if(pod.conditions[][status] == \"True\" and pod.conditions[][type] == \"PodScheduled\", pod.conditions[], else:null))\n   )\n   // Get the first non-null condition = condition with the highest significance\n   | fieldsAdd pod.temp_cond = arrayFirst(arrayRemoveNulls(arrayFlatten(pod.temp_all_conditions)))\n   | fieldsAdd pod.condition = if(isNotNull(pod.temp_cond),\n      record(\n        type=if(pod.temp_cond[type] == \"Initialized\" and pod.temp_cond[reason] == \"PodCompleted\", \"Completed\", else: pod.temp_cond[type]),\n        status=pod.temp_cond[status],\n        lastTransitionTime=pod.temp_cond[lastTransitionTime],\n        reason=pod.temp_cond[reason],\n        message=pod.temp_cond[message]\n      ),\n      else: null)\n  | fieldsRemove pod.temp_cond, pod.temp_all_conditions\n| fieldsAdd k8s.age = record(start = k8s.object[metadata][creationTimestamp], end = if(isNull(k8s.object[metadata][deletionTimestamp]), now(), else:k8s.object[metadata][deletionTimestamp]))\n| fieldsAdd pod.phase = k8s.object[status][phase]\n| fieldsAdd pod.resourceDeletionTimestamp = k8s.object[metadata][deletionTimestamp]\n| fieldsAdd\n  hasDeletionTimestamp = isNotNull(pod.resourceDeletionTimestamp),\n  lifetimeEndUnixSeconds = unixSecondsFromTimestamp(lifetime[end]),\n  resourceDeletionTimestampUnixSeconds = unixSecondsFromTimestamp(toTimestamp(pod.resourceDeletionTimestamp)),\n  nowTimestampUnixSeconds = unixSecondsFromTimestamp(now())\n| fieldsAdd\n  isTerminating = hasDeletionTimestamp and (lifetimeEndUnixSeconds - resourceDeletionTimestampUnixSeconds) >= 120,\n  isDeleted = hasDeletionTimestamp and (nowTimestampUnixSeconds - lifetimeEndUnixSeconds) >= 600\n| fieldsAdd pod.state = if(isTerminating, \"Terminating\", else: pod.phase)\n| fieldsAdd pod.state = if(isDeleted, \"Deleted\", else: pod.state)\n| fieldsRemove hasDeletionTimestamp, lifetimeEndUnixSeconds, resourceDeletionTimestampUnixSeconds, nowTimestampUnixSeconds,  isTerminating, isDeleted\n| fieldsAdd pod.entity = record(entityId = id, displayName = name, lifetimeEndMillis = unixMillisFromTimestamp(lifetime[end]))\n// Fields: related workload\n| fieldsAdd workload.id = coalesce(arrayFirst(toArray(references[is_part_of.k8s_deployment])), arrayFirst(toArray(references[is_part_of.k8s_deploymentconfig])), arrayFirst(toArray(references[is_part_of.k8s_daemonset])), arrayFirst(toArray(references[is_part_of.k8s_statefulset])), arrayFirst(toArray(references[is_part_of.k8s_replicaset])), arrayFirst(toArray(references[is_part_of.k8s_replicationcontroller])), arrayFirst(toArray(references[is_part_of.k8s_job])), arrayFirst(toArray(references[is_part_of.k8s_cronjob]))),\n  workload.type = k8s.workload.kind\n| fieldsAdd node_name = k8s.node.name, vm_name = `tags:k8s.labels`[`vm.kubevirt.io/name`], workload.entity = record(entityId = workload.id, displayName = k8s.workload.name)\n| fieldsRemove k8s.object, `tags:k8s.annotations`, `tags:k8s.labels`, `tags:k8s`\n| fields node_name, vm_name, pod.entity, pod.state, pod.condition, k8s.age, pod.signals_now, containers_now, container_restarts, container_oom_kills, workload.entity, namespace.entity, cluster.entity\n| fieldsAdd pod.entity = pod.entity[displayName], pod.entityId = pod.entity[entityId]\n| fieldsAdd workload.entity = workload.entity[displayName], workload.entityId = workload.entity[entityId]\n| fieldsAdd namespace.entity = namespace.entity[displayName], namespace.entityId = namespace.entity[entityId]\n| fieldsAdd cluster.entity = cluster.entity[displayName], cluster.entityId = cluster.entity[entityId]","visualization":"table","visualizationSettings":{"autoSelectVisualization":true,"table":{"hideColumnsForLargeResults":true,"columnWidths":{"[\"pod.entity\"]":195.39,"[\"pod.entityId\"]":251.09,"[\"namespace.entity\"]":152.4}}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"10":{"title":"Virtual Machines - Utilisation","type":"data","query":"// [pod-explorer]\nsmartscapeNodes { K8S_POD }\n| filter `tags:k8s.labels`[kubevirt.io] == \"virt-launcher\"\n| fieldsAdd cluster.name = k8s.cluster.name, node.name = k8s.node.name, namespace.name = k8s.namespace.name, workload.name = k8s.workload.name, pod.name = name\n// Fields: related cluster\n| fieldsAdd cluster.id = arrayFirst(toArray(references[belongs_to.k8s_cluster])), cluster.cluster_id = k8s.cluster.uid\n| fieldsAdd cluster.entity = record(entityId = cluster.id, displayName = k8s.cluster.name)\n| fieldsAdd cluster.distribution = getNodeField(cluster.id, \"k8s.cluster.distribution\")\n// Filters: [cluster-entity]\n// | filter cluster.entity[displayName] == \"k8s-kubevirt\"\n// Fields: related namespace\n| fieldsAdd namespace.id = arrayFirst(toArray(references[belongs_to.k8s_namespace]))\n| fieldsAdd namespace.entity = record(entityId = namespace.id, displayName = k8s.namespace.name)\n// Filters: [namespace-entity]\n// | filter namespace.entity[displayName] == \"default\"\n| limit 500\n| lookup [\n  // [cpu_usage_now]\n  timeseries values = sum(dt.kubernetes.container.cpu_usage, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd cpu_usage_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{cpu_usage_now}, executionOrder:leftFirst\n| lookup [\n  // [cpu_throttled_now]\n  timeseries values = sum(dt.kubernetes.container.cpu_throttled, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd cpu_throttled_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{cpu_throttled_now}, executionOrder:leftFirst\n| lookup [\n  // [requests_cpu_now]\n  timeseries values = sum(dt.kubernetes.container.requests_cpu, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd requests_cpu_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{requests_cpu_now}, executionOrder:leftFirst\n| lookup [\n  // [limits_cpu_now]\n  timeseries values = sum(dt.kubernetes.container.limits_cpu, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd limits_cpu_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{limits_cpu_now}, executionOrder:leftFirst\n| lookup [\n  // [memory_usage_now]\n  timeseries values = sum(dt.kubernetes.container.memory_working_set, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd memory_usage_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{memory_usage_now}, executionOrder:leftFirst\n| lookup [\n  // [requests_memory_now]\n  timeseries values = sum(dt.kubernetes.container.requests_memory, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd requests_memory_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{requests_memory_now}, executionOrder:leftFirst\n| lookup [\n  // [limits_memory_now]\n  timeseries values = sum(dt.kubernetes.container.limits_memory, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd limits_memory_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{limits_memory_now}, executionOrder:leftFirst\n| lookup [\n  // [network_received_data_now]\n  timeseries values = sum(dt.kubernetes.pod.network_received_data, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd network_received_data_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{network_received_data_now}, executionOrder:leftFirst\n| lookup [\n  // [network_transmitted_data_now]\n  timeseries values = sum(dt.kubernetes.pod.network_transmitted_data, rollup:sum, rate:1m),\n  by:{dt.smartscape.k8s_pod}, timeframe: timeframe(from: -10m, to: -2m),\n  filter: isNotNull(dt.smartscape.k8s_pod)\n| fieldsAdd id = dt.smartscape.k8s_pod\n    | fieldsAdd network_transmitted_data_now = arrayLast(values)\n], sourceField:id, lookupField:id, fields:{network_transmitted_data_now}, executionOrder:leftFirst\n| fieldsAdd node_name = k8s.node.name, vm_name = `tags:k8s.labels`[`vm.kubevirt.io/name`], pod.entity = record(entityId = id, displayName = name, lifetimeEndMillis = unixMillisFromTimestamp(lifetime[end]))\n| fieldsRemove k8s.object, `tags:k8s.annotations`, `tags:k8s.labels`, `tags:k8s`\n| fields node_name, vm_name, pod.entity, cpu_usage_now, cpu_throttled_now, requests_cpu_now, limits_cpu_now, memory_usage_now, requests_memory_now, limits_memory_now, network_received_data_now, network_transmitted_data_now\n| fieldsAdd  pod.entity = pod.entity[displayName], pod.entityId = pod.entity[entityId]","visualization":"table","visualizationSettings":{"autoSelectVisualization":true,"table":{"hideColumnsForLargeResults":true,"columnWidths":{"[\"pod.entity\"]":195.39,"[\"pod.entityId\"]":251.09,"[\"namespace.entity\"]":152.4}},"unitsOverrides":[{"identifier":"memory_usage_now","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1768529152059},{"identifier":"requests_memory_now","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1768529171951},{"identifier":"limits_memory_now","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1768529190256},{"identifier":"network_received_data_now","unitCategory":"datarate","baseUnit":"Bps","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1768529212436},{"identifier":"network_transmitted_data_now","unitCategory":"datarate","baseUnit":"Bps","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1768529256026},{"identifier":"cpu_usage_now","unitCategory":"unspecified","baseUnit":"millicore","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1768529267943},{"identifier":"cpu_throttled_now","unitCategory":"unspecified","baseUnit":"millicore","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1768529269264},{"identifier":"requests_cpu_now","unitCategory":"unspecified","baseUnit":"millicore","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1768529286362}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"11":{"title":"Detailed Virtual Machine information","type":"data","query":"smartscapeNodes \"K8S_CUSTOMRESOURCEDEFINITION\"\n| filter name == \"virtualmachineinstances.kubevirt.io\"\n| fieldsAdd k8s_cluster = references[belongs_to.k8s_cluster]\n| expand k8s_cluster\n| lookup [ fetch dt.entity.kubernetes_cluster ],\n    sourceField: k8s.cluster.uid,\n    lookupField: kubernetesClusterId,\n    fields: { cluster.name = entity.name, cluster_id = id, kubernetesClusterId }\n| lookup [ fetch dt.entity.kubernetes_node ],\n    sourceField: cluster_id,\n    lookupField: clustered_by[dt.entity.kubernetes_cluster],\n    fields: {node_name = entity.name, entity_host_id = belongs_to}\n| lookup [ fetch dt.entity.host ],\n    sourceField: entity_host_id[dt.entity.host],\n    lookupField: id,\n    fields: { host.name = entity.name, host_processes = runs } \n| expand internal_vm_id = host_processes[dt.entity.openstack_vm]\n| lookup [ fetch dt.entity.openstack_vm ], \n    sourceField: internal_vm_id,\n    lookupField: id,\n    fields: { vm_name = entity.name, vm_type = entity.type, vm_process_instance = contains } \n| lookup [ fetch dt.entity.process_group_instance ],\n    sourceField: vm_process_instance[dt.entity.process_group_instance],\n    lookupField: id,\n    fields: { vm_process = entity.name, vm_metadata = metadata} \n| fields k8s_cluster, node_name, vm_process, vm_metadata","visualization":"table","visualizationSettings":{"autoSelectVisualization":true,"table":{"hideColumnsForLargeResults":true,"columnWidths":{"[\"vm_metadata\"]":1483}}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"12":{"title":"Hosts on KubeVirt with OneAgent","type":"data","query":"smartscapeNodes \"HOST\"\n| filter hypervisor.type == \"HYPERVISOR_TYPE_KVM\"\n| fieldsAdd tags\n// | summarize count(), by: {type}","visualization":"table","visualizationSettings":{"autoSelectVisualization":true,"table":{"hideColumnsForLargeResults":true,"columnWidths":{"[\"vm_metadata\"]":1483}}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"13":{"title":"OneAgent Coverage (vms with OA)","type":"data","query":"smartscapeNodes \"HOST\"\n| filter hypervisor.type == \"HYPERVISOR_TYPE_KVM\"\n| fieldsAdd tags\n| summarize count(), by: {type}","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","prefixIcon":"DesktopIcon","colorThresholdTarget":"background"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"count","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-status-ideal-default, #2f6862)"},"comparator":"≥","label":"","value":1},{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"=","label":"","value":0}]}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}}},"layouts":{"1":{"x":0,"y":0,"w":3,"h":7},"2":{"x":0,"y":33,"w":12,"h":5},"3":{"x":6,"y":0,"w":6,"h":7},"4":{"x":12,"y":0,"w":6,"h":7},"5":{"x":18,"y":0,"w":6,"h":7},"6":{"x":0,"y":28,"w":24,"h":5},"7":{"x":0,"y":17,"w":4,"h":6},"8":{"x":4,"y":17,"w":20,"h":6},"9":{"x":0,"y":7,"w":24,"h":5},"10":{"x":0,"y":12,"w":24,"h":5},"11":{"x":0,"y":23,"w":12,"h":5},"12":{"x":12,"y":23,"w":12,"h":5},"13":{"x":3,"y":0,"w":3,"h":7}},"importedWithCode":false,"settings":{},"annotations":[]}